/*! For license information please see background.js.LICENSE.txt */
(()=>{"use strict";var e={445:(e,t)=>{var n,s,o,r,i,a;t.HarmCategory=void 0,(n=t.HarmCategory||(t.HarmCategory={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HarmBlockThreshold=void 0,(s=t.HarmBlockThreshold||(t.HarmBlockThreshold={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",s.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",s.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",s.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",s.BLOCK_NONE="BLOCK_NONE",t.HarmProbability=void 0,(o=t.HarmProbability||(t.HarmProbability={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",o.NEGLIGIBLE="NEGLIGIBLE",o.LOW="LOW",o.MEDIUM="MEDIUM",o.HIGH="HIGH",t.BlockReason=void 0,(r=t.BlockReason||(t.BlockReason={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",r.SAFETY="SAFETY",r.OTHER="OTHER",t.FinishReason=void 0,(i=t.FinishReason||(t.FinishReason={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",i.STOP="STOP",i.MAX_TOKENS="MAX_TOKENS",i.SAFETY="SAFETY",i.RECITATION="RECITATION",i.OTHER="OTHER",t.TaskType=void 0,(a=t.TaskType||(t.TaskType={})).TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",a.RETRIEVAL_QUERY="RETRIEVAL_QUERY",a.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",a.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",a.CLASSIFICATION="CLASSIFICATION",a.CLUSTERING="CLUSTERING";class c extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class d extends c{constructor(e,t){super(e),this.response=t}}const u="0.2.1",l="genai-js";var h;!function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"}(h||(h={}));class E{constructor(e,t,n,s){this.model=e,this.task=t,this.apiKey=n,this.stream=s}toString(){let e=`https://generativelanguage.googleapis.com/v1/${this.model}:${this.task}`;return this.stream&&(e+="?alt=sse"),e}}async function f(e,t,n){let s;try{if(s=await fetch(e.toString(),Object.assign(Object.assign({},function(e){const t={};if((null==e?void 0:e.timeout)>=0){const n=new AbortController,s=n.signal;setTimeout((()=>n.abort()),e.timeout),t.signal=s}return t}(n)),{method:"POST",headers:{"Content-Type":"application/json","x-goog-api-client":`${l}/${u}`,"x-goog-api-key":e.apiKey},body:t})),!s.ok){let e="";try{const t=await s.json();e=t.error.message,t.error.details&&(e+=` ${JSON.stringify(t.error.details)}`)}catch(e){}throw new Error(`[${s.status} ${s.statusText}] ${e}`)}}catch(t){const n=new c(`Error fetching from ${e.toString()}: ${t.message}`);throw n.stack=t.stack,n}return s}function g(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),_(e.candidates[0]))throw new d(`${y(e)}`,e);return function(e){var t,n,s,o;return(null===(o=null===(s=null===(n=null===(t=e.candidates)||void 0===t?void 0:t[0].content)||void 0===n?void 0:n.parts)||void 0===s?void 0:s[0])||void 0===o?void 0:o.text)?e.candidates[0].content.parts[0].text:""}(e)}if(e.promptFeedback)throw new d(`Text not available. ${y(e)}`,e);return""},e}const p=[t.FinishReason.RECITATION,t.FinishReason.SAFETY];function _(e){return!!e.finishReason&&p.includes(e.finishReason)}function y(e){var t,n,s;let o="";if(e.candidates&&0!==e.candidates.length||!e.promptFeedback){if(null===(s=e.candidates)||void 0===s?void 0:s[0]){const t=e.candidates[0];_(t)&&(o+=`Candidate was blocked due to ${t.finishReason}`,t.finishMessage&&(o+=`: ${t.finishMessage}`))}}else o+="Response was blocked",(null===(t=e.promptFeedback)||void 0===t?void 0:t.blockReason)&&(o+=` due to ${e.promptFeedback.blockReason}`),(null===(n=e.promptFeedback)||void 0===n?void 0:n.blockReasonMessage)&&(o+=`: ${e.promptFeedback.blockReasonMessage}`);return o}function m(e){return this instanceof m?(this.v=e,this):new m(e)}"function"==typeof SuppressedError&&SuppressedError;const T=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;async function O(e){const t=[],n=e.getReader();for(;;){const{done:e,value:s}=await n.read();if(e)return g(C(t));t.push(s)}}function A(e){return function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,o=n.apply(e,t||[]),r=[];return s={},i("next"),i("throw"),i("return"),s[Symbol.asyncIterator]=function(){return this},s;function i(e){o[e]&&(s[e]=function(t){return new Promise((function(n,s){r.push([e,t,n,s])>1||a(e,t)}))})}function a(e,t){try{(n=o[e](t)).value instanceof m?Promise.resolve(n.value.v).then(c,d):u(r[0][2],n)}catch(e){u(r[0][3],e)}var n}function c(e){a("next",e)}function d(e){a("throw",e)}function u(e,t){e(t),r.shift(),r.length&&a(r[0][0],r[0][1])}}(this,arguments,(function*(){const t=e.getReader();for(;;){const{value:e,done:n}=yield m(t.read());if(n)break;yield yield m(g(e))}}))}function C(e){const t=e[e.length-1],n={promptFeedback:null==t?void 0:t.promptFeedback};for(const t of e)if(t.candidates)for(const e of t.candidates){const t=e.index;if(n.candidates||(n.candidates=[]),n.candidates[t]||(n.candidates[t]={index:e.index}),n.candidates[t].citationMetadata=e.citationMetadata,n.candidates[t].finishReason=e.finishReason,n.candidates[t].finishMessage=e.finishMessage,n.candidates[t].safetyRatings=e.safetyRatings,e.content&&e.content.parts){n.candidates[t].content||(n.candidates[t].content={role:e.content.role||"user",parts:[{text:""}]});for(const s of e.content.parts)s.text&&(n.candidates[t].content.parts[0].text+=s.text)}}return n}async function S(e,t,n,s){const o=new E(t,h.STREAM_GENERATE_CONTENT,e,!0);return function(e){const t=function(e){const t=e.getReader();return new ReadableStream({start(e){let n="";return function s(){return t.read().then((({value:t,done:o})=>{if(o)return n.trim()?void e.error(new c("Failed to parse stream")):void e.close();n+=t;let r,i=n.match(T);for(;i;){try{r=JSON.parse(i[1])}catch(t){return void e.error(new c(`Error parsing JSON response: "${i[1]}"`))}e.enqueue(r),n=n.substring(i[0].length),i=n.match(T)}return s()}))}()}})}(e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0}))),[n,s]=t.tee();return{stream:A(n),response:O(s)}}(await f(o,JSON.stringify(n),s))}async function R(e,t,n,s){const o=new E(t,h.GENERATE_CONTENT,e,!1),r=await f(o,JSON.stringify(n),s);return{response:g(await r.json())}}function v(e,t){let n=[];if("string"==typeof e)n=[{text:e}];else for(const t of e)"string"==typeof t?n.push({text:t}):n.push(t);return{role:t,parts:n}}function I(e){return e.contents?e:{contents:[v(e,"user")]}}const N="SILENT_ERROR";class w{constructor(e,t,n,s){this.model=t,this.params=n,this.requestOptions=s,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,(null==n?void 0:n.history)&&(this._history=n.history.map((e=>{if(!e.role)throw new Error("Missing role for history item: "+JSON.stringify(e));return v(e.parts,e.role)})))}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e){var t,n;await this._sendPromise;const s=v(e,"user"),o={safetySettings:null===(t=this.params)||void 0===t?void 0:t.safetySettings,generationConfig:null===(n=this.params)||void 0===n?void 0:n.generationConfig,contents:[...this._history,s]};let r;return this._sendPromise=this._sendPromise.then((()=>R(this._apiKey,this.model,o,this.requestOptions))).then((e=>{var t;if(e.response.candidates&&e.response.candidates.length>0){this._history.push(s);const n=Object.assign({parts:[],role:"model"},null===(t=e.response.candidates)||void 0===t?void 0:t[0].content);this._history.push(n)}else{const t=y(e.response);t&&console.warn(`sendMessage() was unsuccessful. ${t}. Inspect response object for details.`)}r=e})),await this._sendPromise,r}async sendMessageStream(e){var t,n;await this._sendPromise;const s=v(e,"user"),o={safetySettings:null===(t=this.params)||void 0===t?void 0:t.safetySettings,generationConfig:null===(n=this.params)||void 0===n?void 0:n.generationConfig,contents:[...this._history,s]},r=S(this._apiKey,this.model,o,this.requestOptions);return this._sendPromise=this._sendPromise.then((()=>r)).catch((e=>{throw new Error(N)})).then((e=>e.response)).then((e=>{if(e.candidates&&e.candidates.length>0){this._history.push(s);const t=Object.assign({},e.candidates[0].content);t.role||(t.role="model"),this._history.push(t)}else{const t=y(e);t&&console.warn(`sendMessageStream() was unsuccessful. ${t}. Inspect response object for details.`)}})).catch((e=>{e.message!==N&&console.error(e)})),r}}class M{constructor(e,t,n){this.apiKey=e,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.requestOptions=n||{}}async generateContent(e){const t=I(e);return R(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings},t),this.requestOptions)}async generateContentStream(e){const t=I(e);return S(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings},t),this.requestOptions)}startChat(e){return new w(this.apiKey,this.model,e,this.requestOptions)}async countTokens(e){const t=I(e);return async function(e,t,n,s){const o=new E(t,h.COUNT_TOKENS,e,!1);return(await f(o,JSON.stringify(Object.assign(Object.assign({},n),{model:t})),void 0)).json()}(this.apiKey,this.model,t)}async embedContent(e){const t="string"==typeof(n=e)||Array.isArray(n)?{content:v(n,"user")}:n;var n;return async function(e,t,n,s){const o=new E(t,h.EMBED_CONTENT,e,!1);return(await f(o,JSON.stringify(n),void 0)).json()}(this.apiKey,this.model,t)}async batchEmbedContents(e){return async function(e,t,n,s){const o=new E(t,h.BATCH_EMBED_CONTENTS,e,!1),r=n.requests.map((e=>Object.assign(Object.assign({},e),{model:t})));return(await f(o,JSON.stringify({requests:r}),s)).json()}(this.apiKey,this.model,e,this.requestOptions)}}t.ChatSession=w,t.GenerativeModel=M,t.GoogleGenerativeAI=class{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new c("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new M(this.apiKey,e,t)}}}},t={};function n(s){var o=t[s];if(void 0!==o)return o.exports;var r=t[s]={exports:{}};return e[s](r,r.exports,n),r.exports}(()=>{var e=n(445),t=e.GoogleGenerativeAI,s=e.HarmCategory,o=e.HarmBlockThreshold;const r=function(e,n){return r=this,i=void 0,c=function(){var r,i,a,c,d;return function(e,t){var n,s,o,r,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,a[0]&&(i=0)),i;)try{if(n=1,s&&(o=2&a[0]?s.return:a[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,a[1])).done)return o;switch(s=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,s=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],s=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,(function(u){switch(u.label){case 0:return e&&""!=e?(r=new t("AIzaSyBbmS7SJFVQeXcAuDOi7KmAB7B2evqfaXg"),i=r.getGenerativeModel({model:"gemini-1.0-pro"}),a={temperature:.9,topK:1,topP:1,maxOutputTokens:2048},c=[{category:s.HARM_CATEGORY_HARASSMENT,threshold:o.BLOCK_MEDIUM_AND_ABOVE},{category:s.HARM_CATEGORY_HATE_SPEECH,threshold:o.BLOCK_MEDIUM_AND_ABOVE},{category:s.HARM_CATEGORY_SEXUALLY_EXPLICIT,threshold:o.BLOCK_MEDIUM_AND_ABOVE},{category:s.HARM_CATEGORY_DANGEROUS_CONTENT,threshold:o.BLOCK_MEDIUM_AND_ABOVE}],d=[{text:'I will share with you my text and which language code I\'m writing. If my language is \'undefined\' or \'null\' you have to detect my language.\nYou have only one task. Find grammarly wrong words, and send me as "[{ "mistake": "worng", "correction": "wrong" }, { "mistake": "worng", "correction": "wrong" }, { "mistake": "worng", "correction": "wrong" }]"\n             I\'m writing in '.concat(n,". My text is: ").concat(e)}],[4,i.generateContent({contents:[{role:"user",parts:d}],generationConfig:a,safetySettings:c})]):[3,2];case 1:return[2,u.sent().response.text()];case 2:return[2]}}))},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{o(c.next(e))}catch(e){t(e)}}function s(e){try{o(c.throw(e))}catch(e){t(e)}}function o(t){var o;t.done?e(t.value):(o=t.value,o instanceof a?o:new a((function(e){e(o)}))).then(n,s)}o((c=c.apply(r,i||[])).next())}));var r,i,a,c};var i;!function(e){e[e.Undefined=0]="Undefined",e[e.Text=1]="Text",e[e.Language=2]="Language"}(i||(i={})),chrome.runtime.onMessage.addListener(((e,t,n)=>{switch(e?.type){case i.Undefined:return;case i.Text:return void chrome.storage.local.get(["Language"]).then((t=>{(async(e,t)=>{chrome.tabs.query({active:!0,currentWindow:!0},(async function(n){var s=await r(e,t);chrome.tabs.sendMessage(n[0].id,{type:"4",message:s})}))})(e.value,t.Language)}));case i.Language:return void chrome.storage.local.set({Language:e.value}).then((()=>{}));default:return}}))})()})();